<!DOCTYPE html>
<html lang="ht">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes, viewport-fit=cover">
    <title>Cash Shalom ¬∑ KAZYE V7</title>
    <style>
        /* RESET */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        }

        html, body {
            width: 100%;
            min-height: 100vh;
            background: #0a2e38;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 12px;
        }

        .app {
            max-width: 820px;
            width: 100%;
            background: white;
            border-radius: 36px;
            padding: 20px 18px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
            display: flex;
            flex-direction: column;
            gap: 18px;
        }

        /* CASH SHALOM HEADER */
        .cash-header {
            background: linear-gradient(145deg, #0a4b5c, #06323d);
            color: white;
            padding: 16px 20px;
            border-radius: 100px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 4px;
        }

        .cash-title {
            font-size: 26px;
            font-weight: 900;
            letter-spacing: 2px;
            text-shadow: 2px 2px 0 #021218;
        }

        .cash-shalom {
            background: #ffd966;
            color: #2d3b0e;
            padding: 8px 22px;
            border-radius: 60px;
            font-weight: 800;
            font-size: 20px;
            box-shadow: inset 0 -3px 0 #b68f2e;
        }

        .section {
            background: white;
            border-radius: 24px;
            padding: 18px 16px;
            border: 1px solid #d9e9ee;
        }

        /* Header balans */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 12px;
        }

        .brand {
            font-size: 24px;
            font-weight: 800;
            color: #0a5a6a;
        }

        .balans-box {
            background: #05222b;
            padding: 12px 24px;
            border-radius: 60px;
            display: flex;
            align-items: center;
            gap: 8px;
            color: white;
            font-weight: 700;
        }

        .balans-number {
            font-size: 28px;
            font-weight: 800;
            color: #ffe083;
        }

        /* Plan */
        .plan-container {
            background: #e6f1f4;
            border-radius: 60px;
            padding: 14px;
        }

        .plan-btns {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: center;
        }

        .plan-item {
            background: white;
            border: none;
            padding: 12px 22px;
            border-radius: 60px;
            font-weight: 700;
            color: #0a4f5c;
            box-shadow: 0 3px 0 #c2d6db;
            cursor: pointer;
            font-size: 15px;
        }

        .plan-item.active {
            background: #0e6f80;
            color: white;
            box-shadow: 0 4px 0 #054852;
        }

        /* Mode */
        .mode-group {
            background: #e6f1f4;
            border-radius: 60px;
            padding: 6px;
            display: flex;
        }

        .mode-btn {
            flex: 1;
            padding: 16px 0;
            border-radius: 60px;
            border: none;
            font-weight: 700;
            font-size: 17px;
            background: transparent;
            color: #165f6b;
            cursor: pointer;
        }

        .mode-btn.active {
            background: white;
            color: #0a4854;
            box-shadow: 0 4px 12px rgba(0,0,0,0.04);
        }

        /* Input */
        .input-area {
            background: #f2fafd;
            border-radius: 28px;
            padding: 18px;
        }

        .input-label {
            font-weight: 700;
            color: #0a5b68;
            margin-bottom: 12px;
        }

        .input-flex {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .input-flex input {
            flex: 1;
            padding: 16px 22px;
            border: 2px solid #c8dfe6;
            border-radius: 60px;
            font-size: 16px;
            outline: none;
            min-width: 200px;
        }

        .btn-primary {
            background: #0d6f80;
            border: none;
            color: white;
            font-weight: 800;
            padding: 16px 36px;
            border-radius: 60px;
            font-size: 17px;
            box-shadow: 0 6px 0 #054852;
            cursor: pointer;
            white-space: nowrap;
        }

        .btn-retrait {
            background: #a85c3a;
            box-shadow: 0 6px 0 #6d3f2b;
        }

        /* Kazye grid */
        .grid-title {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            flex-wrap: wrap;
        }

        .paid-total {
            background: #faebcc;
            padding: 8px 20px;
            border-radius: 40px;
            font-weight: 700;
            color: #564e29;
        }

        .kazye-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 10px;
        }

        .kaz {
            background: #f7feff;
            border: 2px solid #cde1e7;
            border-radius: 20px;
            padding: 14px 4px;
            text-align: center;
            font-weight: 700;
            color: #0a4854;
            cursor: pointer;
            transition: 0.07s;
        }

        .kaz.paid {
            background: #ffd966;
            border-color: #b38f3a;
            color: #2e2c0a;
        }

        /* Rezilta */
        .result-card {
            background: #032b33;
            color: white;
            padding: 24px;
            border-radius: 28px;
        }

        .final-balance {
            font-size: 36px;
            font-weight: 800;
            color: #ffdb8e;
        }

        .auto-list {
            background: #17505c;
            padding: 18px;
            border-radius: 20px;
            margin-top: 16px;
            font-size: 20px;
            font-weight: 700;
            word-break: break-word;
        }

        .info-chip {
            background: #1b5863;
            padding: 8px 20px;
            border-radius: 40px;
            display: inline-block;
            margin-top: 12px;
        }

        .footer-btns {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .btn-sm {
            background: #2d6873;
            border: none;
            color: white;
            padding: 14px 22px;
            border-radius: 60px;
            font-weight: 600;
            box-shadow: 0 4px 0 #1a414a;
            cursor: pointer;
            flex: 1;
        }

        @media (max-width: 550px) {
            .kazye-grid {
                grid-template-columns: repeat(4, 1fr);
            }
            .btn-primary {
                width: 100%;
                justify-content: center;
            }
            .balans-number {
                font-size: 24px;
            }
            .cash-title {
                font-size: 22px;
            }
            .cash-shalom {
                font-size: 18px;
                padding: 6px 18px;
            }
        }

        @media (max-width: 380px) {
            .kazye-grid {
                grid-template-columns: repeat(3, 1fr);
            }
            .cash-header {
                flex-direction: column;
                gap: 10px;
                border-radius: 40px;
            }
        }
    </style>
</head>
<body>
    <div class="app">
        <!-- CASH SHALOM HEADER ANL√à -->
        <div class="cash-header">
            <span class="cash-title">üí∞ CASH SHALOM</span>
            <span class="cash-shalom">‚ú°Ô∏è SHALOM ‚ú°Ô∏è</span>
        </div>

        <!-- HEADER + BALANS -->
        <div class="section">
            <div class="header">
                <span class="brand">üé∞ KAZYE¬∑V7</span>
                <div class="balans-box">
                    <span>üí∞</span>
                    <span class="balans-number" id="balansDisplay">0.00</span>
                    <span>$</span>
                </div>
            </div>
        </div>

        <!-- PLAN (KOR√àK: 20$ olye 25$) -->
        <div class="section">
            <div style="font-weight: 700; color: #0a525e; margin-bottom: 12px;">üìå PLAN (pri = nimewo √ó plan)</div>
            <div class="plan-container">
                <div class="plan-btns" id="planButtons"></div>
            </div>
        </div>

        <!-- MODE DEPO/RETR√à + INPUT -->
        <div class="section">
            <div class="mode-group" id="modeGroup">
                <button id="modeDepot" class="mode-btn active">üíµ DEPO</button>
                <button id="modeRetrait" class="mode-btn">üí∞ RETR√à</button>
            </div>

            <div class="input-area" style="margin-top: 16px;">
                <div class="input-label" id="inputLabel">üíµ ANTRE MONTAN DEPO</div>
                <div class="input-flex">
                    <input type="number" id="montantField" placeholder="Montan $" min="0" step="any">
                    <button class="btn-primary" id="actionButton">üßÆ KALKILE</button>
                </div>
            </div>
        </div>

        <!-- KAZYE 1‚Äì30: MANY√àL SELEKSYON -->
        <div class="section">
            <div class="grid-title">
                <span style="font-weight: 700; color: #0a4f5a;">üéØ KAZYE 1‚Äì30</span>
                <span class="paid-total" id="totalPaidDisplay">0.00$</span>
            </div>
            <p style="color: #3b717d; margin-bottom: 16px; font-size: 14px;">
                üëâ <strong>Klike pou make kazye kliyan gentan peye DEJA.</strong> Sist√®m ap kalkile SOU SA KI RETE s√®lman.
            </p>
            <div class="kazye-grid" id="kazyeGrid"></div>
            <div style="margin-top: 18px;">
                <button class="btn-sm" id="clearPaidBtn">üóëÔ∏è Efase tout kazye peye</button>
            </div>
        </div>

        <!-- REZILTA KALKIL -->
        <div class="result-card">
            <div style="display: flex; justify-content: space-between; align-items: baseline; flex-wrap: wrap;">
                <span style="font-size: 20px; font-weight: 600;">üí∞ BALANS FINAL</span>
                <span class="final-balance" id="finalBalance">0.00</span>
                <span style="font-size: 24px;">$</span>
            </div>
            
            <div style="margin-top: 20px;">
                <div style="font-weight: 600; margin-bottom: 8px;">‚úÖ KAZYE NOUVO SEL√àKSYONNE:</div>
                <div class="auto-list" id="autoList">‚Äî</div>
            </div>

            <div style="display: flex; gap: 16px; flex-wrap: wrap; margin-top: 20px;">
                <span class="info-chip">üìå PLAN: <span id="planLabel">5$</span></span>
                <span class="info-chip">üìÜ D√àNYE KAZYE PEYE: <span id="lastPaidLabel">0</span></span>
                <span class="info-chip">üÜï KAZYE DISPONIB: <span id="availableStartLabel">1</span></span>
            </div>
        </div>

        <!-- BOUTON SEGOND√à -->
        <div class="footer-btns">
            <button class="btn-sm" id="verifyBtn">‚úÖ Verifye balans</button>
            <button class="btn-sm" id="resetBalanceBtn">üîÑ Mete balans 0</button>
        </div>
        
        <!-- CASH SHALOM FOOTER -->
        <div style="text-align: center; color: #176977; font-weight: 600; padding: 8px;">
            ‚ú°Ô∏è CASH SHALOM ¬∑ BENEDICTION ‚ú°Ô∏è
        </div>
    </div>

    <script>
        // ---------- VARIAB GLOBAL ----------
        let balans = 0;
        let plan = 5; // default
        
        // KOR√àK: PLAN 20$ olye 25$ - nou retire 25 nan lis la
        const PLAN_LIST = [1, 2, 3, 4, 5, 10, 15, 20, 50]; // 25$ RETIRE, 20$ AJOUTE

        // Kazye gentan peye (many√®l)
        let paid = new Array(31).fill(false);

        // ---------- DOM ----------
        const balansDisplay = document.getElementById('balansDisplay');
        const planButtons = document.getElementById('planButtons');
        const kazyeGrid = document.getElementById('kazyeGrid');
        const totalPaidDisplay = document.getElementById('totalPaidDisplay');
        const modeDepot = document.getElementById('modeDepot');
        const modeRetrait = document.getElementById('modeRetrait');
        const inputLabel = document.getElementById('inputLabel');
        const actionButton = document.getElementById('actionButton');
        const montantField = document.getElementById('montantField');
        const finalBalance = document.getElementById('finalBalance');
        const autoList = document.getElementById('autoList');
        const planLabel = document.getElementById('planLabel');
        const lastPaidLabel = document.getElementById('lastPaidLabel');
        const availableStartLabel = document.getElementById('availableStartLabel');

        // ---------- FONKSYON BALANS ----------
        function refreshBalans() {
            balansDisplay.innerText = balans.toFixed(2);
        }

        // ---------- KREYE BOUTON PLAN (AVEC 20$, SANS 25$) ----------
        function initPlan() {
            PLAN_LIST.forEach(p => {
                const btn = document.createElement('button');
                btn.innerText = `${p}$`;
                btn.className = 'plan-item';
                if (p === plan) btn.classList.add('active');
                btn.onclick = () => {
                    document.querySelectorAll('.plan-item').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    plan = p;
                    planLabel.innerText = `${plan}$`;
                    refreshGridPrices();
                    updateTotalPaid();
                    updateLastPaidAndAvailable();
                };
                planButtons.appendChild(btn);
            });
        }

        // ---------- KREYE GRIY KAZYE ----------
        function initKazyeGrid() {
            let html = '';
            for (let i = 1; i <= 30; i++) {
                const price = i * plan;
                const paidClass = paid[i] ? 'paid' : '';
                html += `<div class="kaz ${paidClass}" data-kazye="${i}" onclick="togglePaid(${i})">
                            ${i}<br><small style="font-size: 11px;">${price}$</small>
                        </div>`;
            }
            kazyeGrid.innerHTML = html;
        }

        // ---------- REFRESH PRI L√à PLAN CHANJE ----------
        function refreshGridPrices() {
            for (let i = 1; i <= 30; i++) {
                const el = document.querySelector(`.kaz[data-kazye="${i}"]`);
                if (el) {
                    const small = el.querySelector('small');
                    if (small) small.innerText = `${i * plan}$`;
                }
            }
        }

        // ---------- TOGGLE KAZYE GENTAN PEYE ----------
        window.togglePaid = function(k) {
            paid[k] = !paid[k];
            const el = document.querySelector(`.kaz[data-kazye="${k}"]`);
            if (el) {
                if (paid[k]) el.classList.add('paid');
                else el.classList.remove('paid');
            }
            updateTotalPaid();
            updateLastPaidAndAvailable();
        };

        // ---------- UPDATE TOTAL LAJAN PEYE ----------
        function updateTotalPaid() {
            let total = 0;
            for (let i = 1; i <= 30; i++) {
                if (paid[i]) total += i * plan;
            }
            totalPaidDisplay.innerText = total.toFixed(2) + '$';
            return total;
        }

        // ---------- D√àNYE KAZYE PEYE + PREMYE KAZYE DISPONIB ----------
        function updateLastPaidAndAvailable() {
            let last = 0;
            for (let i = 1; i <= 30; i++) {
                if (paid[i]) last = i;
            }
            lastPaidLabel.innerText = last;
            
            let firstAvailable = last + 1;
            if (firstAvailable > 30) firstAvailable = 30;
            availableStartLabel.innerText = firstAvailable;
            
            return last;
        }

        // ---------- DEPO: KALKIL OTOMATIK SOU KAZYE KI RETE ----------
        function handleDepot() {
            const montan = parseFloat(montantField.value);
            if (isNaN(montan) || montan <= 0) {
                alert('Antre yon montan depo valab.');
                return;
            }

            // 1. Ajoute depo nan balans
            balans += montan;

            // 2. D√®nye kazye peye
            let lastPaid = 0;
            for (let i = 1; i <= 30; i++) if (paid[i]) lastPaid = i;
            
            // 3. K√≤manse apati PREMYE KAZYE KI PA PEYE
            let tempBalans = balans;
            let newSelected = [];

            for (let k = lastPaid + 1; k <= 30; k++) {
                // SI KAZYE A PA DEJA PEYE
                if (!paid[k]) {
                    const price = k * plan;
                    if (price <= tempBalans) {
                        newSelected.push(k);
                        tempBalans -= price;
                    } else {
                        break;
                    }
                }
            }

            // 4. AJOUTE KAZYE SA YO NAN paid (SELMAN SI YO PA TE DEJA PRAN)
            newSelected.forEach(k => {
                if (!paid[k]) {
                    paid[k] = true;
                    const el = document.querySelector(`.kaz[data-kazye="${k}"]`);
                    if (el) el.classList.add('paid');
                }
            });

            // 5. Balans final
            balans = tempBalans;

            // 6. UI
            refreshBalans();
            updateTotalPaid();
            updateLastPaidAndAvailable();
            finalBalance.innerText = balans.toFixed(2);
            
            if (newSelected.length > 0) {
                autoList.innerText = newSelected.join(' ¬∑ ');
            } else {
                autoList.innerText = 'Pa gen nouvo kazye disponib.';
            }

            montantField.value = '';
        }

        // ---------- RETR√à ----------
        function handleRetrait() {
            const montan = parseFloat(montantField.value);
            if (isNaN(montan) || montan <= 0) {
                alert('Antre montan pou retire.');
                return;
            }
            if (montan > balans) {
                alert(`‚ùå Balans ensifizan. Balans ou: ${balans.toFixed(2)}$`);
                return;
            }

            balans -= montan;
            refreshBalans();
            finalBalance.innerText = balans.toFixed(2);
            autoList.innerText = '‚Äî (Retr√® pa chanje kazye)';
            montantField.value = '';
        }

        // ---------- CHANJE MODE ----------
        function setMode(newMode) {
            mode = newMode;
            if (mode === 'depot') {
                modeDepot.classList.add('active');
                modeRetrait.classList.remove('active');
                inputLabel.innerText = 'üíµ ANTRE MONTAN DEPO';
                actionButton.classList.remove('btn-retrait');
                actionButton.innerHTML = 'üßÆ KALKILE';
            } else {
                modeRetrait.classList.add('active');
                modeDepot.classList.remove('active');
                inputLabel.innerText = 'üí∞ ANTRE MONTAN RETR√à';
                actionButton.classList.add('btn-retrait');
                actionButton.innerHTML = 'üí∏ RETIRE';
            }
        }

        // ---------- EFASE TOUT KAZYE PEYE ----------
        function clearPaid() {
            for (let i = 1; i <= 30; i++) {
                paid[i] = false;
                const el = document.querySelector(`.kaz[data-kazye="${i}"]`);
                if (el) el.classList.remove('paid');
            }
            updateTotalPaid();
            updateLastPaidAndAvailable();
        }

        // ---------- RESET BALANS ----------
        function resetBalance() {
            balans = 0;
            refreshBalans();
            finalBalance.innerText = '0.00';
        }

        // ---------- VERIFYE ----------
        function verifyBalans() {
            const totalPaid = updateTotalPaid();
            if (totalPaid > balans) {
                alert(`‚ö†Ô∏è Total kazye peye (${totalPaid.toFixed(2)}$) depase balans (${balans.toFixed(2)}$)`);
            } else {
                alert(`‚úÖ Balans kouvri. Rest: ${(balans - totalPaid).toFixed(2)}$`);
            }
        }

        // ---------- INIT ----------
        window.onload = function() {
            initPlan();
            initKazyeGrid();
            refreshBalans();
            planLabel.innerText = `${plan}$`;
            updateTotalPaid();
            updateLastPaidAndAvailable();

            // Mode switch
            modeDepot.addEventListener('click', () => setMode('depot'));
            modeRetrait.addEventListener('click', () => setMode('retrait'));

            // Bouton aksyon prensipal
            actionButton.addEventListener('click', () => {
                if (mode === 'depot') handleDepot();
                else handleRetrait();
            });

            // Efase kazye peye
            document.getElementById('clearPaidBtn').addEventListener('click', clearPaid);

            // Verifye
            document.getElementById('verifyBtn').addEventListener('click', verifyBalans);

            // Reset balans
            document.getElementById('resetBalanceBtn').addEventListener('click', resetBalance);
        };
    </script>
</body>
</html>
